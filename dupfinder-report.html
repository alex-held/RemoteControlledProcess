<html><body>
<h1>Statistics</h1>
<p>Total codebase size: 7594</p>
<p>Code to analyze: 1825</p>
<p>Total size of duplicated fragments: 3650</p>
<h1>Detected Duplicates</h1>
<h2>Duplicated Code. Size: 563</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.bdd.tests\Features\DockerShutdown.feature.cs</p>
<pre>{
            string[] tagsOfScenario = ((string[])(null));
            System.Collections.Specialized.OrderedDictionary argumentsOfScenario = new System.Collections.Specialized.OrderedDictionary();
            TechTalk.SpecFlow.ScenarioInfo scenarioInfo = new TechTalk.SpecFlow.ScenarioInfo("Docker shutdown", null, tagsOfScenario, argumentsOfScenario);
#line 6
  this.ScenarioInitialize(scenarioInfo);
#line hidden
            bool isScenarioIgnored = default(bool);
            bool isFeatureIgnored = default(bool);
            if ((tagsOfScenario != null))
            {
                isScenarioIgnored = tagsOfScenario.Where(__entry =&gt; __entry != null).Where(__entry =&gt; String.Equals(__entry, "ignore", StringComparison.CurrentCultureIgnoreCase)).Any();
            }
            if ((this._featureTags != null))
            {
                isFeatureIgnored = this._featureTags.Where(__entry =&gt; __entry != null).Where(__entry =&gt; String.Equals(__entry, "ignore", StringComparison.CurrentCultureIgnoreCase)).Any();
            }
            if ((isScenarioIgnored || isFeatureIgnored))
            {
                testRunner.SkipScenario();
            }
            else
            {
                this.ScenarioStart();
#line 7
    testRunner.Given("the server is running", ((string)(null)), ((TechTalk.SpecFlow.Table)(null)), "Given ");
#line hidden
#line 8
    testRunner.When("a TERM signal is sent", ((string)(null)), ((TechTalk.SpecFlow.Table)(null)), "When ");
#line hidden
#line 9
    testRunner.Then("the application shuts down.", ((string)(null)), ((TechTalk.SpecFlow.Table)(null)), "Then ");
#line hidden
            }
            this.ScenarioCleanup();
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.bdd.tests\Features\LightSensorReadings.feature.cs</p>
<pre>{
            string[] tagsOfScenario = ((string[])(null));
            System.Collections.Specialized.OrderedDictionary argumentsOfScenario = new System.Collections.Specialized.OrderedDictionary();
            TechTalk.SpecFlow.ScenarioInfo scenarioInfo = new TechTalk.SpecFlow.ScenarioInfo("Robot creates sensor queue", null, tagsOfScenario, argumentsOfScenario);
#line 6
this.ScenarioInitialize(scenarioInfo);
#line hidden
            bool isScenarioIgnored = default(bool);
            bool isFeatureIgnored = default(bool);
            if ((tagsOfScenario != null))
            {
                isScenarioIgnored = tagsOfScenario.Where(__entry =&gt; __entry != null).Where(__entry =&gt; String.Equals(__entry, "ignore", StringComparison.CurrentCultureIgnoreCase)).Any();
            }
            if ((this._featureTags != null))
            {
                isFeatureIgnored = this._featureTags.Where(__entry =&gt; __entry != null).Where(__entry =&gt; String.Equals(__entry, "ignore", StringComparison.CurrentCultureIgnoreCase)).Any();
            }
            if ((isScenarioIgnored || isFeatureIgnored))
            {
                testRunner.SkipScenario();
            }
            else
            {
                this.ScenarioStart();
#line 7
    testRunner.Given("the robot app is started", ((string)(null)), ((TechTalk.SpecFlow.Table)(null)), "Given ");
#line hidden
#line 8
    testRunner.When("the sensor queue is checked", ((string)(null)), ((TechTalk.SpecFlow.Table)(null)), "When ");
#line hidden
#line 9
    testRunner.Then("the sensor queue exists", ((string)(null)), ((TechTalk.SpecFlow.Table)(null)), "Then ");
#line hidden
            }
            this.ScenarioCleanup();
        }</pre>
<h2>Duplicated Code. Size: 263</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.bdd.tests\Steps\ClientProcess.cs</p>
<pre>public static void SendTermSignal()
        {
            TestOutputHelper?.WriteLine("Sending TERM signal to client process ...");

            var killCommand = "kill";
            var killArguments = $"-s TERM {_process.Id}";
            TestOutputHelper?.WriteLine($"Invoking system call: {killCommand} {killArguments}");
            var killProcess = Process.Start(killCommand, killArguments);
            
            if (killProcess != null)
            {
                TestOutputHelper?.WriteLine("Waiting for system call to complete.");
                killProcess.WaitForExit(2000);
                TestOutputHelper?.WriteLine("System call has " + (killProcess.HasExited ? "" : "NOT ") + "completed.");
                killProcess.Kill();
            }

            TestOutputHelper?.WriteLine("Waiting for client process to shutdown ...");
            _process.WaitForExit(2000);

            TestOutputHelper?.WriteLine("Client process has " + (_process.HasExited ? "" : "NOT ") + "completed.");
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.bdd.tests\Steps\RobotProcess.cs</p>
<pre>public static void SendTermSignal()
        {
            TestOutputHelper?.WriteLine("Sending TERM signal to robot process ...");

            var killCommand = "kill";
            var killArguments = $"-s TERM {_process.Id}";
            TestOutputHelper?.WriteLine($"Invoking system call: {killCommand} {killArguments}");
            var killProcess = Process.Start(killCommand, killArguments);
            
            if (killProcess != null)
            {
                TestOutputHelper?.WriteLine("Waiting for system call to complete.");
                killProcess.WaitForExit(2000);
                TestOutputHelper?.WriteLine("System call has " + (killProcess.HasExited ? "" : "NOT ") + "completed.");
                killProcess.Kill();
            }

            TestOutputHelper?.WriteLine("Waiting for robot process to shutdown ...");
            _process.WaitForExit(2000);

            TestOutputHelper?.WriteLine("Robot process has " + (_process.HasExited ? "" : "NOT ") + "completed.");
        }</pre>
<h2>Duplicated Code. Size: 212</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.client.app\SensorDataConsumer.cs</p>
<pre>private void ConnectToRabbitMq()
        {
            try
            {
                _logger.LogDebug("Connecting to RabbitMQ ...");

                var connectionFactory = CreateRabbitMqConnectionFactory();
                _connection = connectionFactory.CreateConnection();
                _channel = _connection.CreateModel();

                _channel.ExchangeDeclare("robot", ExchangeType.Direct, durable: false, autoDelete: true,
                    arguments: null);
                _channel.QueueDeclare("sensors", durable: false, exclusive: false, autoDelete: true,
                    arguments: null);

                _logger.LogInformation("Established connection to RabbitMQ");
            }
            catch (Exception e)
            {
                _logger.LogDebug(e.Message);
                _channel = null;
                _connection = null;
            }
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.robot.app\SensorDataSender.cs</p>
<pre>private void ConnectToRabbitMq()
        {
            try
            {
                _logger.LogDebug("Connecting to RabbitMQ ...");

                var connectionFactory = CreateRabbitMqConnectionFactory();
                _connection = connectionFactory.CreateConnection();
                _channel = _connection.CreateModel();

                _channel.ExchangeDeclare("robot", ExchangeType.Direct, durable: false, autoDelete: true,
                    arguments: null);
                _channel.QueueDeclare("sensors", durable: false, exclusive: false, autoDelete: true,
                    arguments: null);

                _logger.LogInformation("Established connection to RabbitMQ");
            }
            catch (Exception e)
            {
                _logger.LogDebug(e.Message);
                _channel = null;
                _connection = null;
            }
        }</pre>
<h2>Duplicated Code. Size: 169</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.client.app\SensorDataConsumer.cs</p>
<pre>private ConnectionFactory CreateRabbitMqConnectionFactory()
        {
            var connectionFactory = new ConnectionFactory
            {
                VirtualHost = "/",
                ClientProvidedName = "app:robot",
                HostName = _configuration["RabbitMq:HostName"],
                Port = _configuration.GetValue&lt;int&gt;("RabbitMq:Port"),
                UserName = _configuration["RabbitMq:UserName"],
                Password = _configuration["RabbitMq:Password"]
            };
            
            _logger.LogDebug($"RabbitMQ HostName: {connectionFactory.HostName}");
            _logger.LogDebug($"RabbitMQ Port: {connectionFactory.Port}");
            _logger.LogDebug($"RabbitMQ UserName: {connectionFactory.UserName}");
            
            return connectionFactory;
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.robot.app\SensorDataSender.cs</p>
<pre>private ConnectionFactory CreateRabbitMqConnectionFactory()
        {
            var connectionFactory = new ConnectionFactory
            {
                VirtualHost = "/",
                ClientProvidedName = "app:robot",
                HostName = _configuration["RabbitMq:HostName"],
                Port = _configuration.GetValue&lt;int&gt;("RabbitMq:Port"),
                UserName = _configuration["RabbitMq:UserName"],
                Password = _configuration["RabbitMq:Password"]
            };
            
            _logger.LogDebug($"RabbitMQ HostName: {connectionFactory.HostName}");
            _logger.LogDebug($"RabbitMQ Port: {connectionFactory.Port}");
            _logger.LogDebug($"RabbitMQ UserName: {connectionFactory.UserName}");
            
            return connectionFactory;
        }</pre>
<h2>Duplicated Code. Size: 140</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.bdd.tests\Features\DockerShutdown.feature.cs</p>
<pre>public static void FeatureSetup()
        {
            testRunner = TechTalk.SpecFlow.TestRunnerManager.GetTestRunner();
            TechTalk.SpecFlow.FeatureInfo featureInfo = new TechTalk.SpecFlow.FeatureInfo(new System.Globalization.CultureInfo("en-US"), "Features", "Docker Shutdown", "  In order to test the server in paralllel with clients\n  As a developer\n  I want" +
                    " to run the server in as a docker container.", ProgrammingLanguage.CSharp, ((string[])(null)));
            testRunner.OnFeatureStart(featureInfo);
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.bdd.tests\Features\LightSensorReadings.feature.cs</p>
<pre>public static void FeatureSetup()
        {
            testRunner = TechTalk.SpecFlow.TestRunnerManager.GetTestRunner();
            TechTalk.SpecFlow.FeatureInfo featureInfo = new TechTalk.SpecFlow.FeatureInfo(new System.Globalization.CultureInfo("en-US"), "Features", "Light Sensor Readings", "    In order to steer my robot\n    As a robot owner\n    I want to see light senso" +
                    "r readings on the client.", ProgrammingLanguage.CSharp, ((string[])(null)));
            testRunner.OnFeatureStart(featureInfo);
        }</pre>
<h2>Duplicated Code. Size: 113</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.client.app\SensorDataConsumer.cs</p>
<pre>protected override async Task ExecuteAsync(CancellationToken stoppingToken)
        {
            try
            {
                RegisterCancellationRequest(stoppingToken);
                
                while (true)
                {
                    await ExecuteSensorLoopBody(stoppingToken);
                }
            }
            catch (OperationCanceledException)
            {
                // This exception is desired, when shutdown is requested. No action is necessary.
            }
            catch (Exception e)
            {
                _logger.LogCritical(e.ToString());
            }
            finally
            {
                ShutdownService();
            }
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.robot.app\SensorDataSender.cs</p>
<pre>protected override async Task ExecuteAsync(CancellationToken stoppingToken)
        {
            try
            {
                RegisterCancellationRequest(stoppingToken);
                
                while (true)
                {
                    await ExecuteSensorLoopBody(stoppingToken);
                }
            }
            catch (OperationCanceledException)
            {
                // This exception is desired, when shutdown is requested. No action is necessary.
            }
            catch (Exception e)
            {
                _logger.LogCritical(e.ToString());
            }
            finally
            {
                ShutdownService();
            }
        }</pre>
<h2>Duplicated Code. Size: 97</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.bdd.tests\Steps\ClientProcess.cs</p>
<pre>private static void WaitUntilConnectedToRabbitMq()
        {
            const string expectedMessageAfterRabbitMqConnected = "Established connection to RabbitMQ";
            string startupMessage;
            do
            {
                startupMessage = _process.StandardOutput.ReadLine();
                TestOutputHelper.WriteLine(startupMessage);
            } while (startupMessage == null || !startupMessage.Contains(expectedMessageAfterRabbitMqConnected));
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.bdd.tests\Steps\RobotProcess.cs</p>
<pre>private static void WaitUntilConnectedToRabbitMq()
        {
            const string expectedMessageAfterRabbitMqConnected = "Established connection to RabbitMQ";
            string startupMessage;
            do
            {
                startupMessage = _process.StandardOutput.ReadLine();
                TestOutputHelper.WriteLine(startupMessage);
            } while (startupMessage == null || !startupMessage.Contains(expectedMessageAfterRabbitMqConnected));
        }</pre>
<h2>Duplicated Code. Size: 72</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.client.app\SensorDataConsumer.cs</p>
<pre>private void RegisterCancellationRequest(CancellationToken stoppingToken)
        {
            _logger.LogInformation("Waiting for cancellation request");
            stoppingToken.Register(() =&gt; _logger.LogInformation("STOP request received"));
            stoppingToken.ThrowIfCancellationRequested();
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.robot.app\SensorDataSender.cs</p>
<pre>private void RegisterCancellationRequest(CancellationToken stoppingToken)
        {
            _logger.LogInformation("Waiting for cancellation request");
            stoppingToken.Register(() =&gt; _logger.LogInformation("STOP request received"));
            stoppingToken.ThrowIfCancellationRequested();
        }</pre>
<h2>Duplicated Code. Size: 71</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.bdd.tests\Features\DockerShutdown.feature.cs</p>
<pre>public virtual void ScenarioInitialize(TechTalk.SpecFlow.ScenarioInfo scenarioInfo)
        {
            testRunner.OnScenarioInitialize(scenarioInfo);
            testRunner.ScenarioContext.ScenarioContainer.RegisterInstanceAs&lt;Xunit.Abstractions.ITestOutputHelper&gt;(_testOutputHelper);
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.bdd.tests\Features\LightSensorReadings.feature.cs</p>
<pre>public virtual void ScenarioInitialize(TechTalk.SpecFlow.ScenarioInfo scenarioInfo)
        {
            testRunner.OnScenarioInitialize(scenarioInfo);
            testRunner.ScenarioContext.ScenarioContainer.RegisterInstanceAs&lt;Xunit.Abstractions.ITestOutputHelper&gt;(_testOutputHelper);
        }</pre>
<h2>Duplicated Code. Size: 70</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.client.app\SensorDataConsumer.cs</p>
<pre>private async Task ExecuteSensorLoopBody(CancellationToken stoppingToken)
        {
            if (_channel == null)
            {
                ConnectToRabbitMq();
            }

            await Task.Delay(TimeSpan.FromSeconds(2), stoppingToken);
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.robot.app\SensorDataSender.cs</p>
<pre>private async Task ExecuteSensorLoopBody(CancellationToken stoppingToken)
        {
            if (_channel == null)
            {
                ConnectToRabbitMq();
            }

            await Task.Delay(TimeSpan.FromSeconds(2), stoppingToken);
        }</pre>
<h2>Duplicated Code. Size: 55</h2>
<h3>Duplicated Fragments:</h3>
<p>Fragment 1  in file kata-rabbitmq.client.app\SensorDataConsumer.cs</p>
<pre>private void DisconnectFromRabbitMq()
        {
            _channel?.Close();
            _connection?.Close();
            _channel = null;
            _connection = null;
        }</pre>
<p>Fragment 2  in file kata-rabbitmq.robot.app\SensorDataSender.cs</p>
<pre>private void DisconnectFromRabbitMq()
        {
            _channel?.Close();
            _connection?.Close();
            _channel = null;
            _connection = null;
        }</pre>
</body></html>
